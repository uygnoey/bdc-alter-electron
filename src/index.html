<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; frame-src *; img-src * data:;">
    <title>Electron Web Browser / 일렉트론 웹 브라우저</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Navigation bar / 네비게이션 바 */
        .nav-bar {
            background: #ffffff;
            padding: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-buttons {
            display: flex;
            gap: 5px;
        }

        button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        button:hover {
            background: #f0f0f0;
        }

        button:active {
            background: #e0e0e0;
        }

        #url-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        #url-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        /* Tab container / 탭 컨테이너 */
        .tab-container {
            background: #e0e0e0;
            padding: 5px;
            display: flex;
            gap: 5px;
            align-items: center;
            min-height: 40px;
        }

        .tab {
            background: white;
            padding: 8px 16px;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            max-width: 200px;
            position: relative;
        }

        .tab.active {
            background: #4CAF50;
            color: white;
        }

        .tab-title {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
        }

        .tab-close {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
        }

        .tab-close:hover {
            background: rgba(255,0,0,0.3);
        }

        #new-tab-btn {
            padding: 4px 8px;
            font-size: 18px;
            background: transparent;
            border: none;
        }

        /* Webview container / 웹뷰 컨테이너 */
        .webview-container {
            flex: 1;
            position: relative;
            background: white;
        }

        webview {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        webview.hidden {
            display: none;
        }

        /* Loading indicator / 로딩 표시기 */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: #666;
        }

        /* Status bar / 상태 표시줄 */
        .status-bar {
            background: #333;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>
    <!-- Tab Container / 탭 컨테이너 -->
    <div class="tab-container" id="tab-container">
        <button id="new-tab-btn" title="New Tab / 새 탭">+</button>
    </div>

    <!-- Navigation Bar / 네비게이션 바 -->
    <div class="nav-bar">
        <div class="nav-buttons">
            <button id="back-btn" title="Back / 뒤로">←</button>
            <button id="forward-btn" title="Forward / 앞으로">→</button>
            <button id="reload-btn" title="Reload / 새로고침">⟳</button>
            <button id="home-btn" title="Home / 홈">🏠</button>
        </div>
        <input type="text" id="url-input" placeholder="Enter URL / URL을 입력하세요" value="https://www.google.com">
        <button id="go-btn">Go / 이동</button>
    </div>

    <!-- Webview Container / 웹뷰 컨테이너 -->
    <div class="webview-container" id="webview-container">
        <div class="loading">Loading... / 로딩 중...</div>
    </div>

    <!-- Status Bar / 상태 표시줄 -->
    <div class="status-bar">
        <span id="status-text">Ready / 준비됨</span>
        <span id="platform-info"></span>
    </div>

    <script>
        // Tab management / 탭 관리
        let tabs = [];
        let activeTabId = null;
        let tabIdCounter = 0;

        // Create new tab / 새 탭 생성
        function createTab(url = 'https://www.google.com') {
            const tabId = `tab-${tabIdCounter++}`;
            
            // Create tab element / 탭 요소 생성
            const tabElement = document.createElement('div');
            tabElement.className = 'tab';
            tabElement.id = tabId;
            tabElement.innerHTML = `
                <span class="tab-title">New Tab / 새 탭</span>
                <span class="tab-close">×</span>
            `;
            
            // Add tab to container / 컨테이너에 탭 추가
            const newTabBtn = document.getElementById('new-tab-btn');
            document.getElementById('tab-container').insertBefore(tabElement, newTabBtn);
            
            // Create webview / 웹뷰 생성
            const webview = document.createElement('webview');
            webview.id = `webview-${tabId}`;
            webview.src = url;
            webview.className = 'hidden';
            webview.setAttribute('nodeintegration', 'false');
            webview.setAttribute('webpreferences', 'contextIsolation=true');
            document.getElementById('webview-container').appendChild(webview);
            
            // Add to tabs array / 탭 배열에 추가
            tabs.push({
                id: tabId,
                element: tabElement,
                webview: webview,
                url: url
            });
            
            // Tab click event / 탭 클릭 이벤트
            tabElement.addEventListener('click', (e) => {
                if (!e.target.classList.contains('tab-close')) {
                    activateTab(tabId);
                }
            });
            
            // Close tab event / 탭 닫기 이벤트
            tabElement.querySelector('.tab-close').addEventListener('click', (e) => {
                e.stopPropagation();
                closeTab(tabId);
            });
            
            // Webview events / 웹뷰 이벤트
            webview.addEventListener('did-start-loading', () => {
                updateStatus('Loading... / 로딩 중...');
            });
            
            webview.addEventListener('did-stop-loading', () => {
                updateStatus('Ready / 준비됨');
            });
            
            webview.addEventListener('page-title-updated', (e) => {
                const tab = tabs.find(t => t.id === tabId);
                if (tab) {
                    tab.element.querySelector('.tab-title').textContent = e.title || 'Untitled / 제목 없음';
                }
            });
            
            webview.addEventListener('did-navigate', (e) => {
                const tab = tabs.find(t => t.id === tabId);
                if (tab && tab.id === activeTabId) {
                    document.getElementById('url-input').value = e.url;
                }
            });
            
            // Activate the new tab / 새 탭 활성화
            activateTab(tabId);
        }

        // Activate tab / 탭 활성화
        function activateTab(tabId) {
            tabs.forEach(tab => {
                if (tab.id === tabId) {
                    tab.element.classList.add('active');
                    tab.webview.classList.remove('hidden');
                    document.getElementById('url-input').value = tab.webview.src;
                    activeTabId = tabId;
                } else {
                    tab.element.classList.remove('active');
                    tab.webview.classList.add('hidden');
                }
            });
        }

        // Close tab / 탭 닫기
        function closeTab(tabId) {
            const tabIndex = tabs.findIndex(t => t.id === tabId);
            if (tabIndex === -1) return;
            
            const tab = tabs[tabIndex];
            tab.element.remove();
            tab.webview.remove();
            tabs.splice(tabIndex, 1);
            
            // If closing active tab, activate another / 활성 탭을 닫는 경우 다른 탭 활성화
            if (tabId === activeTabId && tabs.length > 0) {
                activateTab(tabs[tabs.length - 1].id);
            }
            
            // Create new tab if no tabs left / 탭이 없으면 새 탭 생성
            if (tabs.length === 0) {
                createTab();
            }
        }

        // Get active webview / 활성 웹뷰 가져오기
        function getActiveWebview() {
            const activeTab = tabs.find(t => t.id === activeTabId);
            return activeTab ? activeTab.webview : null;
        }

        // Update status / 상태 업데이트
        function updateStatus(text) {
            document.getElementById('status-text').textContent = text;
        }

        // Navigation functions / 네비게이션 함수
        document.getElementById('back-btn').addEventListener('click', () => {
            const webview = getActiveWebview();
            if (webview && webview.canGoBack()) {
                webview.goBack();
            }
        });

        document.getElementById('forward-btn').addEventListener('click', () => {
            const webview = getActiveWebview();
            if (webview && webview.canGoForward()) {
                webview.goForward();
            }
        });

        document.getElementById('reload-btn').addEventListener('click', () => {
            const webview = getActiveWebview();
            if (webview) {
                webview.reload();
            }
        });

        document.getElementById('home-btn').addEventListener('click', () => {
            const webview = getActiveWebview();
            if (webview) {
                webview.src = 'https://www.google.com';
                document.getElementById('url-input').value = 'https://www.google.com';
            }
        });

        // URL navigation / URL 네비게이션
        function navigateToUrl() {
            const webview = getActiveWebview();
            if (webview) {
                let url = document.getElementById('url-input').value;
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    url = 'https://' + url;
                }
                webview.src = url;
            }
        }

        document.getElementById('go-btn').addEventListener('click', navigateToUrl);
        document.getElementById('url-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                navigateToUrl();
            }
        });

        // New tab button / 새 탭 버튼
        document.getElementById('new-tab-btn').addEventListener('click', () => {
            createTab();
        });

        // Platform info / 플랫폼 정보
        if (window.electronAPI) {
            document.getElementById('platform-info').textContent = `Platform: ${window.electronAPI.platform}`;
        }

        // Initialize with one tab / 하나의 탭으로 초기화
        createTab();
    </script>
</body>
</html>